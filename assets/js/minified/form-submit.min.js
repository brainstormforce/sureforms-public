import{fieldValidation}from"./validation";function submitFormData(e){var t=sureforms_submit.site_url,e=new FormData(e);return fetch(t+"/wp-json/sureforms/v1/submit-form",{method:"POST",body:e}).then(e=>{if(e.ok)return e}).catch(e=>{console.log(e)})}function showSuccessMessage(e,t){t.style.opacity=1,t.style.display="none",e.classList.add("srfm-active"),setTimeout(()=>{e.style.opacity=1},500)}function redirectToUrl(e){window.location.assign(e)}function showErrorMessage(e){e.removeAttribute("hidden"),console.error("Network Error")}async function handleFormSubmission(e,t,r,s,a,o,n,c,i){try{var l;a.classList.add("srfm-active"),await fieldValidation(t,r,s,e)?a.classList.remove("srfm-active"):(l=await submitFormData(e),a.classList.add("srfm-active"),l?"message"===i?showSuccessMessage(n,e):redirectToUrl(o):showErrorMessage(c))}catch(e){a.classList.remove("srfm-active"),showErrorMessage(c)}}function extractFormAttributesAndElements(e){var t=e.getAttribute("form-id"),r=e.getAttribute("message-type"),s=e.getAttribute("success-url"),a=e.getAttribute("ajaxurl"),o=e.getAttribute("nonce"),n=e.querySelector(".srfm-loader"),c=e.nextElementSibling,i=e.querySelector(".srfm-error-message"),e=e.querySelector("#srfm-submit-btn"),l=e.getAttribute("data-sitekey"),u=e.getAttribute("recaptcha-type");return{formId:t,submitType:r,successUrl:s,ajaxUrl:a,nonce:o,loader:n,successMessage:c,errorMessage:i,submitBtn:e,siteKey:l,recaptchaType:u}}function onloadCallback(){Array.from(document.querySelectorAll(".srfm-form")).forEach(e=>{const{formId:t,submitType:r,successUrl:s,ajaxUrl:a,nonce:o,loader:n,successMessage:c,errorMessage:i,submitBtn:l,siteKey:u,recaptchaType:m}=extractFormAttributesAndElements(e);let d=!1;"v2-invisible"===m&&(grecaptcha.render(l,{sitekey:u,callback:()=>{handleFormSubmission(e,t,a,o,n,s,c,i,r),d=!0}}),l.addEventListener("click",()=>{d&&handleFormSubmission(e,t,a,o,n,s,c,i,r)}))})}document.addEventListener("DOMContentLoaded",function(){for(const t of Array.from(document.querySelectorAll(".srfm-form"))){const{formId:r,submitType:s,successUrl:a,ajaxUrl:o,nonce:n,loader:c,successMessage:i,errorMessage:l,submitBtn:e,siteKey:u,recaptchaType:m}=extractFormAttributesAndElements(t);"v3-reCAPTCHA"===m?e.addEventListener("click",e=>{e.preventDefault(),grecaptcha.ready(function(){grecaptcha.execute(u,{action:"submit"}).then(async function(e){e&&handleFormSubmission(t,r,o,n,c,a,i,l,s)})})}):t.addEventListener("submit",async function(e){e.preventDefault(),handleFormSubmission(t,r,o,n,c,a,i,l,s)})}}),window.onloadCallback=onloadCallback;