"use strict";(self.webpackChunksureforms=self.webpackChunksureforms||[]).push([[9128],{1946:function(t,e,r){r.d(e,{o:function(){return i}});const i=(t,e)=>{new window.IntersectionObserver(((t,r)=>{t[0].intersectionRatio>0&&(e(),r.unobserve(t[0].target))})).observe(t)}},3297:function(t,e,r){r.d(e,{a:function(){return o},g:function(){return n},i:function(){return a},t:function(){return c}});var i=r(290);const n=t=>t.amount_off&&t.currency?s({amount:t.amount_off,currency:t.currency}):t.percent_off?(0|t.percent_off)+"% off":"",s=({amount:t,currency:e})=>{const r=((t,e)=>["bif","clp","djf","gnf","jpy","kmf","krw"].includes(e)?t:t/100)(t,e);return`${new Intl.NumberFormat(void 0,{style:"currency",currency:e}).format(parseFloat(r.toFixed(2)))}`},o=(t="usd")=>{const[e]=new Intl.NumberFormat(void 0,{style:"currency",currency:t}).formatToParts();return null==e?void 0:e.value},c=(t,e,r=(0,i._)("every","surecart"),n=(0,i._)("once","surecart"),s=!1)=>{switch(e){case"day":return`${r} ${(0,i.s)(s?(0,i.a)("%d day","%d days",t,"surecart"):(0,i.a)("day","%d days",t,"surecart"),t)}`;case"week":return`${r} ${(0,i.s)(s?(0,i.a)("%d week","%d weeks",t,"surecart"):(0,i.a)("week","%d weeks",t,"surecart"),t)}`;case"month":return`${r} ${(0,i.s)(s?(0,i.a)("%d month","%d months",t,"surecart"):(0,i.a)("month","%d months",t,"surecart"),t)}`;case"year":return`${r} ${(0,i.s)(s?(0,i.a)("%d year","%d years",t,"surecart"):(0,i.a)("year","%d years",t,"surecart"),t)}`;default:return n}},a=(t,e={})=>{if(!t)return"";const{showOnce:r,labels:n}=e,{interval:s=(0,i._)("every","surecart"),period:o=(0,i._)("for","surecart")}=n||{};return`${u(t,s,r?(0,i._)("once","surecart"):"")} ${l(t,o)}`},u=(t,e,r=(0,i._)("once","surecart"))=>t.recurring_interval_count&&t.recurring_interval?c(t.recurring_interval_count,t.recurring_interval,` ${e}`,r):"",l=(t,e,r="")=>(null==t?void 0:t.recurring_period_count)&&(null==t?void 0:t.recurring_interval)?c(((null==t?void 0:t.recurring_period_count)||0)*(null==t?void 0:t.recurring_interval_count),null==t?void 0:t.recurring_interval,` ${e}`,r,!0):""},9128:function(t,e,r){r.r(e),r.d(e,{sc_upcoming_invoice:function(){return l}});var i=r(6046),n=r(290),s=r(712),o=r(1946),c=r(3297),a=r(9737),u=r(8517);r(5115);const l=class{constructor(t){(0,i.r)(this,t),this.quantityUpdatesEnabled=!0}componentWillLoad(){(0,o.o)(this.el,(()=>{this.fetchItems()}))}isFutureInvoice(){return this.invoice.period_start_at>=(new Date).getTime()/1e3}async fetchItems(){var t,e;try{this.loading=!0,await Promise.all([this.getInvoice(),this.getPrice()])}catch(r){console.error(r),this.error=(null===(e=null===(t=null==r?void 0:r.additional_errors)||void 0===t?void 0:t[0])||void 0===e?void 0:e.message)||(null==r?void 0:r.message)||(0,n._)("Something went wrong","surecart")}finally{this.loading=!1}}async getPrice(){this.priceId&&(this.price=await(0,s.a)({path:(0,u.a)(`surecart/v1/prices/${this.priceId}`,{expand:["product"]})}))}async getInvoice(){if(this.subscriptionId)return this.invoice=await(0,s.a)({path:(0,u.a)(`surecart/v1/subscriptions/${this.subscriptionId}/upcoming_invoice/`,{expand:["invoice.subscription","subscription.price","subscription.payment_method","payment_method.card","invoice.discount","invoice.invoice_items","invoice_item.price","price.product"],subscription:{price:this.priceId,quantity:this.quantity,...this.adHocAmount?{ad_hoc_amount:this.adHocAmount}:{},...this.discount?{discount:this.discount}:{}}})}),this.invoice}async applyCoupon(t){try{this.couponError="",this.busy=!0,this.discount={promotion_code:t.detail},await this.getInvoice()}catch(t){this.couponError=(null==t?void 0:t.message)||(0,n._)("Something went wrong","surecart")}finally{this.busy=!1}}async updateQuantity(t){try{this.error="",this.busy=!0,this.quantity=t.detail,await this.getInvoice()}catch(t){this.error=(null==t?void 0:t.message)||(0,n._)("Something went wrong","surecart")}finally{this.busy=!1}}async onSubmit(){try{this.error="",this.busy=!0,await(0,s.a)({path:`surecart/v1/subscriptions/${this.subscriptionId}`,method:"PATCH",data:{price:this.priceId,quantity:this.quantity,...this.adHocAmount?{ad_hoc_amount:this.adHocAmount}:{},...this.discount?{discount:this.discount}:{}}}),this.successUrl?window.location.assign(this.successUrl):this.busy=!1}catch(t){this.error=(null==t?void 0:t.message)||(0,n._)("Something went wrong","surecart"),this.busy=!1}}renderName(t){var e;return"string"!=typeof(null==t?void 0:t.product)?null===(e=null==t?void 0:t.product)||void 0===e?void 0:e.name:(0,n._)("Plan","surecart")}renderRenewalText(){var t;return this.isFutureInvoice()?(0,i.h)("div",null,(0,n._)("You'll be switched to this plan","surecart")," ",(0,i.h)("strong",null,(0,n._)("at the end of your billing cycle on","surecart")," ",(0,i.h)("sc-format-date",{type:"timestamp",date:null===(t=this.invoice)||void 0===t?void 0:t.period_start_at,month:"short",day:"numeric",year:"numeric"}))):(0,i.h)("div",null,(0,n._)("You'll be switched to this plan","surecart")," ",(0,i.h)("strong",null,(0,n._)("immediately","surecart")))}renderEmpty(){return(0,i.h)("slot",{name:"empty"},(0,n._)("Something went wrong.","surecart"))}renderLoading(){return(0,i.h)("div",null,(0,i.h)("sc-skeleton",{style:{width:"30%",marginBottom:"0.75em"}}),(0,i.h)("sc-skeleton",{style:{width:"20%",marginBottom:"0.75em"}}),(0,i.h)("sc-skeleton",{style:{width:"40%"}}))}renderContent(){var t,e;return this.loading?this.renderLoading():this.invoice?(0,i.h)("div",{class:"new-plan"},(0,i.h)("div",{class:"new-plan__heading"},this.renderName(this.price)),(0,i.h)("div",null,(0,i.h)("sc-format-number",{type:"currency",currency:null===(t=null==this?void 0:this.invoice)||void 0===t?void 0:t.currency,value:null===(e=null==this?void 0:this.invoice)||void 0===e?void 0:e.total_amount})," ",(0,c.i)(this.price)),(0,i.h)("div",{style:{fontSize:"var(--sc-font-size-small)"}},this.renderRenewalText())):this.renderEmpty()}renderPrice(t){var e;return(0,i.h)("sc-format-number",{type:"currency",currency:this.invoice.currency,value:null===(e=this.invoice)||void 0===e?void 0:e[t]})}renderSummary(){var t,e,r;if(this.loading)return this.renderLoading();if(!this.invoice)return this.renderEmpty();const{card:s}=this.invoice.subscription.payment_method;return(0,i.h)(i.F,null,null===(t=this.invoice.invoice_items)||void 0===t?void 0:t.data.map((t=>{var e,r,n,s,o;return(0,i.h)("sc-product-line-item",{imageUrl:null===(r=null===(e=t.price)||void 0===e?void 0:e.product)||void 0===r?void 0:r.image_url,name:null===(s=null===(n=t.price)||void 0===n?void 0:n.product)||void 0===s?void 0:s.name,editable:this.quantityUpdatesEnabled,removable:!1,quantity:null==t?void 0:t.quantity,amount:null==t?void 0:t.total_amount,currency:null===(o=null==t?void 0:t.price)||void 0===o?void 0:o.currency,interval:(0,c.i)(null==t?void 0:t.price),onScUpdateQuantity:t=>this.updateQuantity(t)})})),(0,i.h)("sc-line-item",null,(0,i.h)("span",{slot:"description"},(0,n._)("Subtotal","surecart")),(0,i.h)("span",{slot:"price"},this.renderPrice("subtotal_amount"))),(0,i.h)("sc-coupon-form",{label:(0,n._)("Add Coupon Code"),onScApplyCoupon:t=>this.applyCoupon(t),error:this.couponError},(0,n._)("Add Coupon Code")),!!this.invoice.tax_amount&&(0,i.h)("sc-line-item",null,(0,i.h)("span",{slot:"description"},(null===(e=this.invoice)||void 0===e?void 0:e.tax_label)||(0,n._)("Tax","surecart")),(0,i.h)("span",{slot:"price"},this.renderPrice("tax_amount"))),this.invoice.total_amount!==this.invoice.amount_due&&(0,i.h)(i.F,null,(0,i.h)("sc-divider",{style:{"--spacing":"0"}}),(0,i.h)("sc-line-item",null,(0,i.h)("span",{slot:"title"},(0,n._)("Total","surecart")),(0,i.h)("span",{slot:"price"},this.renderPrice("total_amount"))),!!this.invoice.proration_amount&&(0,i.h)("sc-line-item",null,(0,i.h)("span",{slot:"description"},(0,n._)("Proration Credit","surecart")),(0,i.h)("span",{slot:"price"},this.renderPrice("proration_amount")))),(0,i.h)("sc-divider",{style:{"--spacing":"0"}}),(0,i.h)("sc-line-item",null,(0,i.h)("span",{slot:"description"},(0,n._)("Payment","surecart")),(0,i.h)("a",{href:(0,u.a)(window.location.href,{action:"payment"}),slot:"price-description"},(0,i.h)("sc-flex",{"justify-content":"flex-start","align-items":"center",style:{"--spacing":"0.5em"}},(0,a.c)(null==s?void 0:s.brand),(0,i.h)("span",{style:{fontSize:"7px",whiteSpace:"nowrap"}},"⬤"," ","⬤"," ","⬤"," ","⬤"),(0,i.h)("span",null,null==s?void 0:s.last4),(0,i.h)("sc-icon",{name:"edit-3"})))),(0,i.h)("sc-line-item",{style:{"--price-size":"var(--sc-font-size-x-large)"}},(0,i.h)("span",{slot:"title"},(0,n._)("Total Due Today","surecart")),this.isFutureInvoice()?(0,i.h)("sc-format-number",{type:"currency",currency:null===(r=this.invoice)||void 0===r?void 0:r.currency,slot:"price"}):(0,i.h)("span",{slot:"price"},this.renderPrice("amount_due")),(0,i.h)("span",{slot:"currency"},this.invoice.currency)))}render(){return(0,i.h)("div",{class:"upcoming-invoice"},this.error&&(0,i.h)("sc-alert",{open:!!this.error,type:"danger"},(0,i.h)("span",{slot:"title"},(0,n._)("Error","surecart")),this.error),(0,i.h)(i.F,null,(0,i.h)("sc-dashboard-module",{heading:(0,n._)("New Plan","surecart"),class:"plan-preview",error:this.error},(0,i.h)("sc-card",null,this.renderContent())),(0,i.h)("sc-dashboard-module",{heading:(0,n._)("Summary","surecart"),class:"plan-summary"},(0,i.h)("sc-form",{onScFormSubmit:()=>this.onSubmit()},(0,i.h)("sc-card",null,this.renderSummary()),(0,i.h)("sc-button",{type:"primary",full:!0,submit:!0,loading:this.loading||this.busy,disabled:this.loading||this.busy},(0,n._)("Confirm","surecart")))),(0,i.h)("sc-text",{style:{"--text-align":"center","--font-size":"var(--sc-font-size-small)","--line-height":"var(--sc-line-height-normal)"}},(0,i.h)("slot",{name:"terms"}))),this.busy&&(0,i.h)("sc-block-ui",null))}get el(){return(0,i.g)(this)}};l.style=":host{display:block;position:relative}.upcoming-invoice{display:grid;gap:var(--sc-spacing-large)}.upcoming-invoice>*{display:grid;gap:var(--sc-spacing-medium)}.new-plan{display:grid;gap:0.25em;color:var(--sc-color-gray-600)}.new-plan__heading{font-weight:var(--sc-font-weight-bold);color:var(--sc-color-gray-800)}"},9737:function(t,e,r){r.d(e,{c:function(){return i},i:function(){return n}});const i=t=>t&&t[0].toUpperCase()+t.slice(1),n=t=>{let e;try{e=new URL(t)}catch(t){return!1}return"http:"===e.protocol||"https:"===e.protocol}}}]);
//# sourceMappingURL=9128.js.map