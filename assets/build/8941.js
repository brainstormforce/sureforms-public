"use strict";(self.webpackChunksureforms=self.webpackChunksureforms||[]).push([[8941],{8941:function(t,s,i){i.r(s),i.d(s,{sc_subscription_payment:function(){return l}});var e=i(6046),n=i(290),o=i(712),r=i(8517);i(5115);const l=class{constructor(t){(0,e.r)(this,t),this.paymentMethods=[],this.customerIds=[]}componentWillLoad(){this.fetchItems()}async fetchItems(){try{this.loading=!0,await Promise.all([this.fetchSubscription(),this.fetchPaymentMethods()])}catch(t){console.error(this.error),this.error=(null==t?void 0:t.message)||(0,n._)("Something went wrong","surecart")}finally{this.loading=!1}}async fetchSubscription(){this.subscriptionId&&(this.subscription=await(0,o.a)({path:(0,r.a)(`/surecart/v1/subscriptions/${this.subscriptionId}`,{expand:["price","price.product","latest_invoice","product"]})}))}async fetchPaymentMethods(){var t;this.paymentMethods=await(0,o.a)({path:(0,r.a)("/surecart/v1/payment_methods",{expand:["card"],customer_ids:this.customerIds,...null!==(null===(t=this.subscription)||void 0===t?void 0:t.live_mode)?{live_mode:this.subscription.live_mode}:{}})})}async handleSubmit(t){var s;const{method:i}=await t.target.getFormJson();try{this.error="",this.busy=!0,await(0,o.a)({path:`/surecart/v1/subscriptions/${null===(s=this.subscription)||void 0===s?void 0:s.id}`,method:"PATCH",data:{payment_method:i}}),this.successUrl?window.location.assign(this.successUrl):this.busy=!1}catch(t){this.error=(null==t?void 0:t.message)||(0,n._)("Something went wrong","surecart"),this.busy=!1}}renderLoading(){return(0,e.h)(e.F,null,(0,e.h)("sc-choice",{name:"loading",disabled:!0},(0,e.h)("sc-skeleton",{style:{width:"60px",display:"inline-block"}}),(0,e.h)("sc-skeleton",{style:{width:"80px",display:"inline-block"},slot:"price"}),(0,e.h)("sc-skeleton",{style:{width:"120px",display:"inline-block"},slot:"description"})),(0,e.h)("sc-button",{type:"primary",full:!0,submit:!0,loading:!0,busy:!0}),!!this.backUrl&&(0,e.h)("sc-button",{href:this.backUrl,full:!0,loading:!0,busy:!0}))}renderContent(){if(this.loading)return this.renderLoading();const t=this.paymentMethods.filter((t=>{var s;return(null==t?void 0:t.live_mode)===(null===(s=this.subscription)||void 0===s?void 0:s.live_mode)}));return(null==t?void 0:t.length)?(0,e.h)(e.F,null,(0,e.h)("sc-choices",null,(0,e.h)("div",null,(this.paymentMethods||[]).map((({id:t,card:s,live_mode:i})=>{var o,r;return i!==(null===(o=null==this?void 0:this.subscription)||void 0===o?void 0:o.live_mode)?null:(0,e.h)("sc-choice",{checked:(null===(r=this.subscription)||void 0===r?void 0:r.payment_method)===t,name:"method",value:t},(0,e.h)("sc-flex",{"justify-content":"flex-start","align-items":"center",style:{"--spacing":"0.5em"}},(0,e.h)("sc-cc-logo",{style:{fontSize:"36px"},brand:null==s?void 0:s.brand}),(0,e.h)("span",{style:{fontSize:"7px",whiteSpace:"nowrap"}},"⬤"," ","⬤"," ","⬤"," ","⬤"),(0,e.h)("span",null,null==s?void 0:s.last4)),(0,e.h)("span",{slot:"per"},(0,n._)("Expires","surecart")," ",null==s?void 0:s.exp_month,"/",null==s?void 0:s.exp_year))})))),(0,e.h)("sc-button",{type:"primary",full:!0,submit:!0,loading:this.loading||this.busy,disabled:this.loading||this.busy},(0,n._)("Update","surecart")),!!this.backUrl&&(0,e.h)("sc-button",{href:this.backUrl,full:!0,loading:this.loading||this.busy,disabled:this.loading||this.busy},(0,n._)("Go Back","surecart"))):(0,e.h)(e.F,null,(0,e.h)("sc-empty",{icon:"credit-card"},(0,n._)("You have no saved payment methods.","surecart")),!!this.backUrl&&(0,e.h)("sc-button",{href:this.backUrl,full:!0},(0,n._)("Go Back","surecart")))}render(){return(0,e.h)("sc-dashboard-module",{heading:(0,n._)("Select a payment method","surecart"),class:"subscription-payment",error:this.error},(0,e.h)("sc-form",{onScFormSubmit:t=>this.handleSubmit(t)},(0,e.h)("sc-card",null,this.renderContent())),this.busy&&(0,e.h)("sc-block-ui",null))}};l.style=":host{display:block;position:relative}.subscription-payment{display:grid;gap:0.5em}"}}]);
//# sourceMappingURL=8941.js.map