"use strict";(self.webpackChunksureforms=self.webpackChunksureforms||[]).push([[4121],{7231:function(i,r,t){t.d(r,{o:function(){return e}});const e=(i,r)=>{new window.IntersectionObserver(((i,t)=>{i[0].intersectionRatio>0&&(r(),t.unobserve(i[0].target))})).observe(i)}},5241:function(i,r,t){t.d(r,{a:function(){return o},g:function(){return s},i:function(){return c},t:function(){return l}});var e=t(9988);const s=i=>i.amount_off&&i.currency?n({amount:i.amount_off,currency:i.currency}):i.percent_off?(0|i.percent_off)+"% off":"",n=({amount:i,currency:r})=>{const t=((i,r)=>["bif","clp","djf","gnf","jpy","kmf","krw"].includes(r)?i:i/100)(i,r);return`${new Intl.NumberFormat(void 0,{style:"currency",currency:r}).format(parseFloat(t.toFixed(2)))}`},o=(i="usd")=>{const[r]=new Intl.NumberFormat(void 0,{style:"currency",currency:i}).formatToParts();return null==r?void 0:r.value},l=(i,r,t=(0,e._)("every","surecart"),s=(0,e._)("once","surecart"),n=!1)=>{switch(r){case"day":return`${t} ${(0,e.s)(n?(0,e.a)("%d day","%d days",i,"surecart"):(0,e.a)("day","%d days",i,"surecart"),i)}`;case"week":return`${t} ${(0,e.s)(n?(0,e.a)("%d week","%d weeks",i,"surecart"):(0,e.a)("week","%d weeks",i,"surecart"),i)}`;case"month":return`${t} ${(0,e.s)(n?(0,e.a)("%d month","%d months",i,"surecart"):(0,e.a)("month","%d months",i,"surecart"),i)}`;case"year":return`${t} ${(0,e.s)(n?(0,e.a)("%d year","%d years",i,"surecart"):(0,e.a)("year","%d years",i,"surecart"),i)}`;default:return s}},c=(i,r={})=>{if(!i)return"";const{showOnce:t,labels:s}=r,{interval:n=(0,e._)("every","surecart"),period:o=(0,e._)("for","surecart")}=s||{};return`${u(i,n,t?(0,e._)("once","surecart"):"")} ${a(i,o)}`},u=(i,r,t=(0,e._)("once","surecart"))=>i.recurring_interval_count&&i.recurring_interval?l(i.recurring_interval_count,i.recurring_interval,` ${r}`,t):"",a=(i,r,t="")=>(null==i?void 0:i.recurring_period_count)&&(null==i?void 0:i.recurring_interval)?l(((null==i?void 0:i.recurring_period_count)||0)*(null==i?void 0:i.recurring_interval_count),null==i?void 0:i.recurring_interval,` ${r}`,t,!0):""},4121:function(i,r,t){t.r(r),t.d(r,{sc_subscription_switch:function(){return u}});var e=t(7492),s=t(9988),n=t(1479),o=t(7231),l=t(5241),c=t(2538);t(7094);const u=class{constructor(i){(0,e.r)(this,i),this.filterAbove=4,this.products=[],this.filter="month"}componentWillLoad(){(0,o.o)(this.el,(async()=>{try{this.loading=!0,await Promise.all([this.getGroup(),this.getProductPrices()])}catch(i){console.error(i),(null==i?void 0:i.message)?this.error=i.message:this.error=(0,s._)("Something went wrong","surecart")}finally{this.loading=!1}})),this.handleSubscriptionChange()}handleProductsChange(){var i;this.prices=this.products.map((i=>{var r,t;return null===(t=null===(r=i)||void 0===r?void 0:r.prices)||void 0===t?void 0:t.data})).flat().filter(((i,r,t)=>t.findIndex((r=>r.id===i.id))===r)),this.showFilters=(null===(i=this.prices)||void 0===i?void 0:i.length)>this.filterAbove}handlePricesChange(i,r){!(null==r?void 0:r.length)&&(null==i?void 0:i.length)&&(this.selectedPrice=i.find((i=>{var r,t;return i.id===(null===(t=null===(r=this.subscription)||void 0===r?void 0:r.price)||void 0===t?void 0:t.id)}))),this.hasFilters={...this.hasFilters,split:this.prices.some((i=>"month"===i.recurring_interval&&(null==i?void 0:i.recurring_period_count))),month:this.prices.some((i=>"month"===i.recurring_interval&&!(null==i?void 0:i.recurring_period_count))),year:this.prices.some((i=>"year"===i.recurring_interval)),never:this.prices.some((i=>"never"===i.recurring_interval||!i.recurring_interval))}}handleSubscriptionChange(){var i,r;this.filter=(null===(r=null===(i=this.subscription)||void 0===i?void 0:i.price)||void 0===r?void 0:r.recurring_interval)||"month"}async getGroup(){if(!this.productGroupId)return;const i=await await(0,n.a)({path:(0,c.a)("surecart/v1/products/",{product_group_ids:[this.productGroupId],expand:["prices"],...this.query})});this.products=[...this.products,...i]}async getProductPrices(){if(!this.productId)return;const i=await await(0,n.a)({path:(0,c.a)(`surecart/v1/products/${this.productId}`,{expand:["prices"]})});this.products=[...this.products,i]}async handleSubmit(i){var r;const{plan:t}=await i.target.getFormJson(),e=this.prices.find((i=>i.id===t)),s=null===(r=this.subscription)||void 0===r?void 0:r.price;if((null==e?void 0:e.id)!==s.id||(null==e?void 0:e.ad_hoc)){if(null==e?void 0:e.ad_hoc)return this.busy=!0,window.location.assign((0,c.a)(window.location.href,{action:"confirm_amount",price_id:t}));this.busy=!0,window.location.assign((0,c.a)(window.location.href,{action:"confirm",price_id:t}))}}renderSwitcher(){if(Object.values(this.hasFilters||{}).filter((i=>!!i)).length>1&&this.showFilters)return(0,e.h)("sc-flex",{slot:"end",class:"subscriptions-switch__switcher"},this.hasFilters.month&&(0,e.h)("sc-button",{onClick:()=>this.filter="month",size:"small",type:"month"===this.filter?"default":"text"},(0,s._)("Monthly","surecart")),this.hasFilters.week&&(0,e.h)("sc-button",{onClick:()=>this.filter="week",size:"small",type:"week"===this.filter?"default":"text"},(0,s._)("Weekly","surecart")),this.hasFilters.year&&(0,e.h)("sc-button",{onClick:()=>this.filter="year",size:"small",type:"year"===this.filter?"default":"text"},(0,s._)("Yearly","surecart")),this.hasFilters.never&&(0,e.h)("sc-button",{onClick:()=>this.filter="never",size:"small",type:"never"===this.filter?"default":"text"},(0,s._)("Lifetime","surecart")),this.hasFilters.split&&(0,e.h)("sc-button",{onClick:()=>this.filter="split",size:"small",type:"split"===this.filter?"default":"text"},(0,s._)("Payment Plan","surecart")))}renderLoading(){return(0,e.h)("sc-choice",{name:"loading",disabled:!0},(0,e.h)("sc-skeleton",{style:{width:"60px",display:"inline-block"}}),(0,e.h)("sc-skeleton",{style:{width:"80px",display:"inline-block"},slot:"price"}),(0,e.h)("sc-skeleton",{style:{width:"120px",display:"inline-block"},slot:"description"}))}isHidden(i){if(!this.showFilters)return!1;let r=this.filter!==i.recurring_interval;return"never"!==this.filter||(null==i?void 0:i.recurring_interval)||(r=!1),"split"===this.filter&&(null==i?void 0:i.recurring_period_count)&&(r=!1),r}renderContent(){return this.loading?this.renderLoading():(0,e.h)("sc-choices",{required:!0},(0,e.h)("div",null,(this.prices||[]).map((i=>{var r,t;const n=(null===(t=null===(r=this.subscription)||void 0===r?void 0:r.price)||void 0===t?void 0:t.id)===(null==i?void 0:i.id),o=this.products.find((r=>r.id===(null==i?void 0:i.product)));return(0,e.h)("sc-choice",{key:null==i?void 0:i.id,checked:n,name:"plan",value:null==i?void 0:i.id,hidden:this.isHidden(i),onScChange:r=>{r.detail&&(this.selectedPrice=this.prices.find((r=>r.id===(null==i?void 0:i.id))))}},(0,e.h)("div",null,(0,e.h)("strong",null,null==o?void 0:o.name)),(0,e.h)("div",{slot:"description"},(null==i?void 0:i.ad_hoc)?`${(0,s._)("Custom amount","surecart")} ${(0,l.i)(i)}`:(0,e.h)(e.F,null,(0,e.h)("sc-format-number",{type:"currency",currency:(null==i?void 0:i.currency)||"usd",value:null==i?void 0:i.amount})," ",(0,l.i)(i,{showOnce:!0}))),n&&(0,e.h)("sc-tag",{type:"warning",slot:"price"},(0,s._)("Current Plan","surecart")))}))))}buttonText(){var i,r,t,e;return(null===(i=this.selectedPrice)||void 0===i?void 0:i.ad_hoc)?(null===(r=this.selectedPrice)||void 0===r?void 0:r.id)===(null===(e=null===(t=this.subscription)||void 0===t?void 0:t.price)||void 0===e?void 0:e.id)?(0,s._)("Update Amount","surecart"):(0,s._)("Choose Amount","surecart"):(0,s._)("Next","surecart")}render(){var i,r,t,n,o,l,c,u;return!this.loading&&(null===(i=this.prices)||void 0===i?void 0:i.length)<2&&!(null===(t=null===(r=this.prices)||void 0===r?void 0:r[0])||void 0===t?void 0:t.ad_hoc)?null:(null===(n=this.subscription)||void 0===n?void 0:n.remaining_period_count)?(0,e.h)("sc-alert",{type:"info",open:!0},(0,s._)("To make changes to your payment plan, please contact us.","surecart")):(0,e.h)("sc-dashboard-module",{heading:this.heading||(0,s._)("Update Plan","surecart"),class:"subscription-switch",error:this.error},(0,e.h)("span",{slot:"end"},this.renderSwitcher()),(0,e.h)("sc-form",{class:"subscriptions-switch",onScFormSubmit:i=>this.handleSubmit(i)},this.renderContent(),(0,e.h)("sc-button",{type:"primary",full:!0,submit:!0,loading:this.loading||this.busy,disabled:(null===(l=null===(o=this.subscription)||void 0===o?void 0:o.price)||void 0===l?void 0:l.id)===(null===(c=this.selectedPrice)||void 0===c?void 0:c.id)&&!(null===(u=this.selectedPrice)||void 0===u?void 0:u.ad_hoc)},this.buttonText()," ",(0,e.h)("sc-icon",{name:"arrow-right",slot:"suffix"})),this.busy&&(0,e.h)("sc-block-ui",{style:{zIndex:"9"}})))}get el(){return(0,e.g)(this)}static get watchers(){return{products:["handleProductsChange"],prices:["handlePricesChange"],subscription:["handleSubscriptionChange"]}}};u.style=":host{display:block;position:relative}[hidden]{display:none !important}.subscriptions-switch{display:grid;gap:0.5em}.subscriptions-switch__switcher{background:rgba(0, 0, 0, 0.035);padding:2px;line-height:1;border-radius:var(--sc-border-radius-small)}"}}]);
//# sourceMappingURL=4121.js.map