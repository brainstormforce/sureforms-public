"use strict";(self.webpackChunksureforms=self.webpackChunksureforms||[]).push([[4837],{8578:function(e,t,r){r.d(t,{o:function(){return i}});var n=r(6046),i=function(e,t,r){void 0===r&&(r=!0);var i="Function"===e.constructor.name?e.prototype:e,o=i.componentWillLoad;i.componentWillLoad=function(){var e,i=this,c=(0,n.g)(this),s={promise:new Promise((function(t){e=t})),resolve:e},u=new CustomEvent("openWormhole",{bubbles:!0,composed:!0,detail:{consumer:this,fields:t,updater:function(e,t){(e in c?c:i)[e]=t},onOpen:s}});c.dispatchEvent(u);var a=function(){if(o)return o.call(i)};return r?s.promise.then((function(){return a()})):a()}}},4447:function(e,t,r){r.d(t,{a:function(){return c},c:function(){return n},h:function(){return o},i:function(){return i}});const n=e=>((null==e?void 0:e.data)||[]).map((e=>({price_id:e.price.id,quantity:e.quantity}))),i=(e,t)=>{var r;return!!((null==(r=null==t?void 0:t.line_items)?void 0:r.data)||[]).map((e=>e.price.id)).find((t=>(null==e?void 0:e.id)===t))},o=e=>{var t,r,n;return!!(null===(r=null===(t=null==e?void 0:e.line_items)||void 0===t?void 0:t.data)||void 0===r?void 0:r.length)&&(null===(n=null==e?void 0:e.line_items.data)||void 0===n?void 0:n.some((e=>{var t;return null===(t=null==e?void 0:e.price)||void 0===t?void 0:t.recurring_interval_count})))},c=e=>{var t;return o(e)&&(null===(t=null==e?void 0:e.line_items.data)||void 0===t?void 0:t.some((e=>{var t;return null===(t=null==e?void 0:e.price)||void 0===t?void 0:t.recurring_period_count})))}},3297:function(e,t,r){r.d(t,{a:function(){return c},g:function(){return i},i:function(){return u},t:function(){return s}});var n=r(290);const i=e=>e.amount_off&&e.currency?o({amount:e.amount_off,currency:e.currency}):e.percent_off?(0|e.percent_off)+"% off":"",o=({amount:e,currency:t})=>{const r=((e,t)=>["bif","clp","djf","gnf","jpy","kmf","krw"].includes(t)?e:e/100)(e,t);return`${new Intl.NumberFormat(void 0,{style:"currency",currency:t}).format(parseFloat(r.toFixed(2)))}`},c=(e="usd")=>{const[t]=new Intl.NumberFormat(void 0,{style:"currency",currency:e}).formatToParts();return null==t?void 0:t.value},s=(e,t,r=(0,n._)("every","surecart"),i=(0,n._)("once","surecart"),o=!1)=>{switch(t){case"day":return`${r} ${(0,n.s)(o?(0,n.a)("%d day","%d days",e,"surecart"):(0,n.a)("day","%d days",e,"surecart"),e)}`;case"week":return`${r} ${(0,n.s)(o?(0,n.a)("%d week","%d weeks",e,"surecart"):(0,n.a)("week","%d weeks",e,"surecart"),e)}`;case"month":return`${r} ${(0,n.s)(o?(0,n.a)("%d month","%d months",e,"surecart"):(0,n.a)("month","%d months",e,"surecart"),e)}`;case"year":return`${r} ${(0,n.s)(o?(0,n.a)("%d year","%d years",e,"surecart"):(0,n.a)("year","%d years",e,"surecart"),e)}`;default:return i}},u=(e,t={})=>{if(!e)return"";const{showOnce:r,labels:i}=t,{interval:o=(0,n._)("every","surecart"),period:c=(0,n._)("for","surecart")}=i||{};return`${a(e,o,r?(0,n._)("once","surecart"):"")} ${d(e,c)}`},a=(e,t,r=(0,n._)("once","surecart"))=>e.recurring_interval_count&&e.recurring_interval?s(e.recurring_interval_count,e.recurring_interval,` ${t}`,r):"",d=(e,t,r="")=>(null==e?void 0:e.recurring_period_count)&&(null==e?void 0:e.recurring_interval)?s(((null==e?void 0:e.recurring_period_count)||0)*(null==e?void 0:e.recurring_interval_count),null==e?void 0:e.recurring_interval,` ${t}`,r,!0):""},4837:function(e,t,r){r.r(t),r.d(t,{sc_price_choice:function(){return B}});var n=r(6046),i=r(290),o=r(8578),c=r(4447),s=r(3297),u=r(712),a=r(8517);function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),e}function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(this,arguments)}function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function f(e){return!(!e||"function"!=typeof e.hasOwnProperty||!(e.hasOwnProperty("__ownerID")||e._map&&e._map.hasOwnProperty("__ownerID")))}function v(e,t,r){return Object.keys(e).reduce((function(t,n){var i=""+n;return t.has(i)?t.set(i,r(t.get(i),e[i])):t}),t)}r(5115);var m=function(e){return function(t){return f(t)?t.get(e):t[e]}},y=function(){function e(e,t,r){if(void 0===t&&(t={}),void 0===r&&(r={}),!e||"string"!=typeof e)throw new Error("Expected a string key for Entity, but found "+e+".");var n=r,i=n.idAttribute,o=void 0===i?"id":i,c=n.mergeStrategy,s=void 0===c?function(e,t){return l({},e,t)}:c,u=n.processStrategy,a=void 0===u?function(e){return l({},e)}:u,d=n.fallbackStrategy,h=void 0===d?function(e,t){}:d;this._key=e,this._getId="function"==typeof o?o:m(o),this._idAttribute=o,this._mergeStrategy=s,this._processStrategy=a,this._fallbackStrategy=h,this.define(t)}var t=e.prototype;return t.define=function(e){this.schema=Object.keys(e).reduce((function(t,r){var n,i=e[r];return l({},t,((n={})[r]=i,n))}),this.schema||{})},t.getId=function(e,t,r){return this._getId(e,t,r)},t.merge=function(e,t){return this._mergeStrategy(e,t)},t.fallback=function(e,t){return this._fallbackStrategy(e,t)},t.normalize=function(e,t,r,n,i,o){var c=this,s=this.getId(e,t,r),u=this.key;if(u in o||(o[u]={}),s in o[u]||(o[u][s]=[]),o[u][s].some((function(t){return t===e})))return s;o[u][s].push(e);var a=this._processStrategy(e,t,r);return Object.keys(this.schema).forEach((function(t){if(a.hasOwnProperty(t)&&"object"==typeof a[t]){var r=c.schema[t],s="function"==typeof r?r(e):r;a[t]=n(a[t],a,t,s,i,o)}})),i(this,a,e,t,r),s},t.denormalize=function(e,t){var r=this;return f(e)?v(this.schema,e,t):(Object.keys(this.schema).forEach((function(n){if(e.hasOwnProperty(n)){var i=r.schema[n];e[n]=t(e[n],i)}})),e)},h(e,[{key:"key",get:function(){return this._key}},{key:"idAttribute",get:function(){return this._idAttribute}}]),e}(),g=function(){function e(e,t){t&&(this._schemaAttribute="string"==typeof t?function(e){return e[t]}:t),this.define(e)}var t=e.prototype;return t.define=function(e){this.schema=e},t.getSchemaAttribute=function(e,t,r){return!this.isSingleSchema&&this._schemaAttribute(e,t,r)},t.inferSchema=function(e,t,r){if(this.isSingleSchema)return this.schema;var n=this.getSchemaAttribute(e,t,r);return this.schema[n]},t.normalizeValue=function(e,t,r,n,i,o){var c=this.inferSchema(e,t,r);if(!c)return e;var s=n(e,t,r,c,i,o);return this.isSingleSchema||null==s?s:{id:s,schema:this.getSchemaAttribute(e,t,r)}},t.denormalizeValue=function(e,t){var r=f(e)?e.get("schema"):e.schema;return this.isSingleSchema||r?t((this.isSingleSchema?void 0:f(e)?e.get("id"):e.id)||e,this.isSingleSchema?this.schema:this.schema[r]):e},h(e,[{key:"isSingleSchema",get:function(){return!this._schemaAttribute}}]),e}(),_=function(e){function t(t,r){if(!r)throw new Error('Expected option "schemaAttribute" not found on UnionSchema.');return e.call(this,t,r)||this}p(t,e);var r=t.prototype;return r.normalize=function(e,t,r,n,i,o){return this.normalizeValue(e,t,r,n,i,o)},r.denormalize=function(e,t){return this.denormalizeValue(e,t)},t}(g),w=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var r=t.prototype;return r.normalize=function(e,t,r,n,i,o){var c=this;return Object.keys(e).reduce((function(t,r,s){var u,a=e[r];return null!=a?l({},t,((u={})[r]=c.normalizeValue(a,e,r,n,i,o),u)):t}),{})},r.denormalize=function(e,t){var r=this;return Object.keys(e).reduce((function(n,i){var o,c=e[i];return l({},n,((o={})[i]=r.denormalizeValue(c,t),o))}),{})},t}(g),b=function(e){return Array.isArray(e)?e:Object.keys(e).map((function(t){return e[t]}))},k=function(e,t,r,n,i,o,c){return e=function(e){if(Array.isArray(e)&&e.length>1)throw new Error("Expected schema definition to be a single schema, but found "+e.length+".");return e[0]}(e),b(t).map((function(t,s){return i(t,r,n,e,o,c)}))},E=function(e){function t(){return e.apply(this,arguments)||this}p(t,e);var r=t.prototype;return r.normalize=function(e,t,r,n,i,o){var c=this;return b(e).map((function(e,s){return c.normalizeValue(e,t,r,n,i,o)})).filter((function(e){return null!=e}))},r.denormalize=function(e,t){var r=this;return e&&e.map?e.map((function(e){return r.denormalizeValue(e,t)})):e},t}(g),I=function(e,t,r,n,i,o,c){var s=l({},t);return Object.keys(e).forEach((function(r){var n=e[r],u="function"==typeof n?n(t):n,a=i(t[r],t,r,u,o,c);null==a?delete s[r]:s[r]=a})),s},S=function(e,t,r){if(f(t))return v(e,t,r);var n=l({},t);return Object.keys(e).forEach((function(t){null!=n[t]&&(n[t]=r(n[t],e[t]))})),n},P=function(){function e(e){this.define(e)}var t=e.prototype;return t.define=function(e){this.schema=Object.keys(e).reduce((function(t,r){var n,i=e[r];return l({},t,((n={})[r]=i,n))}),this.schema||{})},t.normalize=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return I.apply(void 0,[this.schema].concat(t))},t.denormalize=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return S.apply(void 0,[this.schema].concat(t))},e}(),A=function e(t,r,n,i,o,c){return"object"==typeof t&&t?"object"!=typeof i||i.normalize&&"function"==typeof i.normalize?i.normalize(t,r,n,e,o,c):(Array.isArray(i)?k:I)(i,t,r,n,e,o,c):t},O={Array:E,Entity:y,Object:P,Union:_,Values:w};const j={integration:new O.Entity("integration"),account:new O.Entity("account"),price:new O.Entity("price"),product:new O.Entity("product"),product_group:new O.Entity("product_group"),purchase:new O.Entity("purchase"),payment_method:new O.Entity("payment_method"),card:new O.Entity("card"),invoice:new O.Entity("invoice"),latest_invoice:new O.Entity("latest_invoice"),refund:new O.Entity("refund"),charge:new O.Entity("charge"),coupon:new O.Entity("coupon"),promotion:new O.Entity("promotion"),order:new O.Entity("order"),customer:new O.Entity("customer"),subscription:new O.Entity("subscription"),product_group:new O.Entity("product_group")},{price:C,product:z,purchase:L,payment_method:x,card:$,invoice:H,refund:V,charge:F,coupon:W,promotion:q,order:U,integration:T,customer:D,product_group:N,subscription:R}=j;z.define({prices:{data:[C]},product_group:N}),C.define({product:z}),H.define({purchases:{data:[L]},charge:F,customer:D,subscription:R}),U.define({purchases:{data:[L]},charge:F,customer:D,subscription:R}),F.define({order:U,invoice:H}),R.define({latest_invoice:H,purchase:L,price:C,payment_method:x,order:U,customer:D}),V.define({charge:F,customer:D}),L.define({order:U,product:z,subscription:R}),x.define({card:$}),W.define({promotions:{data:[q]}}),N.define({}),T.define({});const M=e=>j?.[e?.[0]?.object]?function(e,t){if(!e||"object"!=typeof e)throw new Error('Unexpected input given to normalize. Expected type to be "object", found "'+(null===e?"null":typeof e)+'".');var r={},n=function(e){return function(t,r,n,i,o){var c=t.key,s=t.getId(n,i,o);c in e||(e[c]={});var u=e[c][s];e[c][s]=u?t.merge(u,r):r}}(r);return{entities:r,result:A(e,e,null,t,n,{})}}(e,[j[e?.[0]?.object]]):{},B=class{constructor(e){(0,n.r)(this,e),this.scUpdateLineItem=(0,n.c)(this,"scUpdateLineItem",7),this.scRemoveLineItem=(0,n.c)(this,"scRemoveLineItem",7),this.scAddEntities=(0,n.c)(this,"scAddEntities",7),this.loading=!1,this.showLabel=!0,this.showPrice=!0,this.showControl=!0,this.prices={},this.products={},this.quantity=1,this.checked=!1}handlePriceIdChage(){var e;this.price&&(null===(e=this.price)||void 0===e?void 0:e.id)===this.priceId||this.fetchPriceWithProduct()}handlePricesChange(){var e,t,r;Object.keys(this.prices||{}).length&&Object.keys(this.products||{}).length&&(this.price=null===(e=null==this?void 0:this.prices)||void 0===e?void 0:e[this.priceId],this.product=null===(t=null==this?void 0:this.products)||void 0===t?void 0:t[null===(r=null==this?void 0:this.price)||void 0===r?void 0:r.product])}handlePriscChange(){var e;this.isAdHoc=null===(e=null==this?void 0:this.price)||void 0===e?void 0:e.ad_hoc}handleErrorsChange(){var e;const t=((null===(e=null==this?void 0:this.error)||void 0===e?void 0:e.additional_errors)||[]).find((e=>{var t;return"line_items.ad_hoc_amount"===(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.attribute)}));this.adHocErrorMessage=(null==t?void 0:t.message)?null==t?void 0:t.message:""}handleCheckedChange(){var e;(null===(e=this.price)||void 0===e?void 0:e.ad_hoc)&&this.choice.checked&&setTimeout((()=>{this.adHocInput.triggerFocus()}),50)}componentWillLoad(){this.price||this.fetchPriceWithProduct()}async fetchPriceWithProduct(){if(this.priceId)try{this.loading=!0;const{products:e,prices:t}=await(async({ids:e,archived:t=!1})=>(e=>{const{entities:t}=M(e);return{prices:null==t?void 0:t.price,products:null==t?void 0:t.product}})(await(0,u.a)({path:(0,a.a)("surecart/v1/prices/",{ids:e,archived:t,expand:["product"]})})))({archived:!1,ids:[this.priceId]});this.scAddEntities.emit({prices:t,products:e})}catch(e){}finally{this.loading=!1}}isInOrder(){return(0,c.i)(this.price,this.order)}isChecked(){return this.isInOrder()}onChangeAdHoc(e){this.scUpdateLineItem.emit({price_id:this.priceId,quantity:this.quantity,ad_hoc_amount:e.target.value})}getLineItem(){var e,t;return((null===(t=null===(e=this.order)||void 0===e?void 0:e.line_items)||void 0===t?void 0:t.data)||[]).find((e=>e.price.id===this.priceId))}showAdHoc(){var e,t;return!!(null===(e=this.price)||void 0===e?void 0:e.ad_hoc)&&(!!this.isInOrder()||(null===(t=null==this?void 0:this.choice)||void 0===t?void 0:t.checked))}renderAdHoc(){var e,t;return(0,n.h)("sc-price-input",{ref:e=>this.adHocInput=e,required:!0,label:"Enter an amount",value:((null===(e=this.getLineItem())||void 0===e?void 0:e.ad_hoc_amount)||(null===(t=this.getLineItem())||void 0===t?void 0:t.total_amount)).toString(),onScChange:e=>this.onChangeAdHoc(e),min:this.price.ad_hoc_min_amount,max:this.price.ad_hoc_max_amount})}renderEmpty(){var e;return(null===(e=null===window||void 0===window?void 0:window.wp)||void 0===e?void 0:e.blocks)?(0,n.h)("sc-alert",{type:"danger",open:!0,style:{margin:"0px"}},(0,i._)("This product has been archived.","surecart")):(0,n.h)(n.H,{style:{display:"none"}})}renderPrice(){return(0,n.h)(n.F,null,(0,n.h)("span",{slot:"price"},(0,n.h)("sc-format-number",{type:"currency",value:this.price.amount,currency:this.price.currency})),(0,n.h)("span",{slot:"per"},(0,s.i)(this.price,{labels:{interval:"/",period:(0,i._)("for","surecart")}})))}render(){var e,t,r,i;return this.loading?(0,n.h)("sc-choice",{name:"loading",showLabel:this.showLabel,showPrice:this.showPrice,showControl:this.showControl,disabled:!0},(0,n.h)("sc-skeleton",{style:{width:"60px",display:"inline-block"}}),(0,n.h)("sc-skeleton",{style:{width:"80px",display:"inline-block"},slot:"price"}),this.description&&(0,n.h)("sc-skeleton",{style:{width:"120px",display:"inline-block"},slot:"description"})):!(null===(e=null==this?void 0:this.price)||void 0===e?void 0:e.id)||(null===(t=this.price)||void 0===t?void 0:t.archived)||(null===(r=this.product)||void 0===r?void 0:r.archived)?this.renderEmpty():(0,n.h)(n.F,null,(0,n.h)("sc-choice",{ref:e=>this.choice=e,value:this.priceId,type:this.type,showLabel:this.showLabel,showPrice:this.showPrice,showControl:this.showControl,checked:this.isChecked()},this.label||(null===(i=null==this?void 0:this.product)||void 0===i?void 0:i.name),this.description&&(0,n.h)("span",{slot:"description"},this.description),this.renderPrice()))}static get watchers(){return{priceId:["handlePriceIdChage"],prices:["handlePricesChange"],products:["handlePricesChange"],price:["handlePriscChange"],error:["handleErrorsChange"],checked:["handleCheckedChange"]}}};(0,o.o)(B,["prices","products","order","error"],!1),B.style="sc-price-choice{display:block;min-width:0;width:100%}"}}]);