async function getUniqueValidationData(t,e,r,s){let o="action=validation_ajax_action&nonce="+encodeURIComponent(s)+"&id="+encodeURIComponent(e);Object.keys(t).forEach(e=>{o+="&"+encodeURIComponent(e)+"="+encodeURIComponent(t[e])});try{var a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o});if(a.ok)return(await a.json()).data}catch(e){console.error(e)}}async function fieldValidation(e,t,r,s){let o=!1,a=null,i=null;var c=document.querySelectorAll('input[aria-unique="true"]');if(0!==c.length){var n={};for(const A of c){var l=A.name,m=A.value;n[l]=m}i=await getUniqueValidationData(n,e,t,r)}for(const L of Array.from(s.querySelectorAll(".srfm-block-single"))){var u=L.closest("form").getAttribute("form-id");if(u===e){var u=L.querySelector("input, textarea,select"),f=u.getAttribute("aria-required"),d=u.getAttribute("aria-unique");let t=u.getAttribute("name");var b=u.value,g=L.querySelector(".srfm-error-message"),y=u.getAttribute("format-type");if(t=t&&t.replace(/_/g," "),f&&"hidden"!==u.type&&("true"!==f||b?u&&u.closest(".srfm-block").classList.remove("srfm-error"):(u&&u.closest(".srfm-block").classList.add("srfm-error"),g&&(g.textContent=g.getAttribute("data-error-msg")),o=!0,a=a||u)),"true"===d&&""!==b&&(i?.some(e=>"not unique"===e[t])?(u&&u.closest(".srfm-block").classList.add("srfm-error"),g.textContent=g.getAttribute("data-unique-msg"),o=!0,a=a||u):u&&u.closest(".srfm-block").classList.remove("srfm-error")),L.classList.contains("srfm-rating-block")||L.classList.contains("srfm-multi-choice-block")||L.classList.contains("srfm-checkbox-container")){var p=L.querySelectorAll("input"),f=p[0].getAttribute("aria-required");let t=!1,r=null;for(let e=0;e<p.length;e++)if(r||"hidden"===p[e].type||(r=p[e]),p[e].checked){t=!0;break}"true"!==f||t?g&&L.classList.remove("srfm-error"):(g&&L.classList.add("srfm-error"),o=!0,!a&&r&&(a=r))}if(L.classList.contains("srfm-phone-block")&&(d=L.querySelectorAll("input")[1],L.classList.contains("srfm-phone-error"))&&(L.classList.add("srfm-error"),o=!0,a=a||d),"decimal"!==y||""===b||b.includes(".")||(u.value+=".00"),L.classList.contains("srfm-password-block-wrap")&&(f=L)&&(d=f.querySelector(".srfm-password-confirm-block"))&&(y=d.querySelector(".srfm-input-password-confirm").value,f=d.querySelector(".srfm-error-message"),!y&&f?(f.textContent=f.getAttribute("data-error-msg"),d.classList.add("srfm-error"),a=a||y,o=!0):y!==b?(d.classList.add("srfm-error"),f.textContent="Confirmation Password is not the same",a=a||y,o=!0):d.classList.remove("srfm-error")),L.classList.contains("srfm-email-block-wrap")&&(f=L)&&(y=f.querySelector(".srfm-email-confirm-block"))&&(d=y.querySelector(".srfm-input-email-confirm").value,f=y.querySelector(".srfm-error-message"),!d&&f?(f.textContent=f.getAttribute("data-error-msg"),y.classList.add("srfm-error"),a=a||d,o=!0):d!==b?(y.classList.add("srfm-error"),f.textContent="Confirmation email is not the same",a=a||d,o=!0):y.classList.remove("srfm-error")),L.classList.contains("srfm-address-block")){var v=L.querySelectorAll("input,select"),h=v[1].getAttribute("aria-required");for(let e=1;e<v.length&&"true"===h;e++)v[e].value||2===e?L.classList.remove("srfm-error"):(L.classList.add("srfm-error"),o=!0,a=a||v[e])}L.classList.contains("srfm-upload-block")&&("true"!==(d=(f=L.querySelector(".srfm-input-upload")).getAttribute("aria-required"))&&f.value?u&&u.closest(".srfm-block").classList.remove("srfm-error"):("true"===d&&g&&(g.textContent=g.getAttribute("data-error-msg")),u&&u.closest(".srfm-block").classList.add("srfm-error"),o=!0,a=a||f)),L.classList.contains("srfm-number-block")&&(y=u.getAttribute("min"),d=u.getAttribute("max"),b)&&(y&&(""!==y&&Number(b)<Number(y)?(u.closest(".srfm-block").classList.add("srfm-error"),g&&(g.textContent="Minimum value is "+y)):u.closest(".srfm-block").classList.remove("srfm-error")),d)&&(""!==d&&Number(b)>Number(d)?(u.closest(".srfm-block").classList.add("srfm-error"),g&&(g.textContent="Maximum value is "+d)):u.closest(".srfm-block").classList.remove("srfm-error"))}}return a&&a.focus(),o}function submitFormData(e){var t=sureforms_submit.site_url,e=new FormData(e);return fetch(t+"/wp-json/sureforms/v1/submit-form",{method:"POST",body:e}).then(e=>{if(e.ok)return e}).catch(e=>{console.log(e)})}function showSuccessMessage(e,t){t.style.opacity=1,t.style.display="none",e.classList.add("srfm-active"),setTimeout(()=>{e.style.opacity=1},500)}function redirectToUrl(e){window.location.assign(e)}function showErrorMessage(e){e.removeAttribute("hidden"),console.error("Network Error")}async function handleFormSubmission(e,t,r,s,o,a,i,c,n){try{var l;o.classList.add("srfm-active"),await fieldValidation(t,r,s,e)?o.classList.remove("srfm-active"):(l=await submitFormData(e),o.classList.add("srfm-active"),l?"message"===n?showSuccessMessage(i,e):redirectToUrl(a):showErrorMessage(c))}catch(e){o.classList.remove("srfm-active"),showErrorMessage(c)}}function extractFormAttributesAndElements(e){var t=e.getAttribute("form-id"),r=e.getAttribute("message-type"),s=e.getAttribute("success-url"),o=e.getAttribute("ajaxurl"),a=e.getAttribute("nonce"),i=e.querySelector(".srfm-loader"),c=e.nextElementSibling,n=e.querySelector(".srfm-error-message"),e=e.querySelector("#srfm-submit-btn"),l=e.getAttribute("data-sitekey"),m=e.getAttribute("recaptcha-type");return{formId:t,submitType:r,successUrl:s,ajaxUrl:o,nonce:a,loader:i,successMessage:c,errorMessage:n,submitBtn:e,siteKey:l,recaptchaType:m}}function onloadCallback(){Array.from(document.querySelectorAll(".srfm-form")).forEach(e=>{const{formId:t,submitType:r,successUrl:s,ajaxUrl:o,nonce:a,loader:i,successMessage:c,errorMessage:n,submitBtn:l,siteKey:m,recaptchaType:u}=extractFormAttributesAndElements(e);let f=!1;"v2-invisible"===u&&(grecaptcha.render(l,{sitekey:m,callback:()=>{handleFormSubmission(e,t,o,a,i,s,c,n,r),f=!0}}),l.addEventListener("click",()=>{f&&handleFormSubmission(e,t,o,a,i,s,c,n,r)}))})}document.addEventListener("DOMContentLoaded",function(){for(const t of Array.from(document.querySelectorAll(".srfm-form"))){const{formId:r,submitType:s,successUrl:o,ajaxUrl:a,nonce:i,loader:c,successMessage:n,errorMessage:l,submitBtn:e,siteKey:m,recaptchaType:u}=extractFormAttributesAndElements(t);"v3-reCAPTCHA"===u?e.addEventListener("click",e=>{e.preventDefault(),grecaptcha.ready(function(){grecaptcha.execute(m,{action:"submit"}).then(async function(e){e&&handleFormSubmission(t,r,a,i,c,o,n,l,s)})})}):t.addEventListener("submit",async function(e){e.preventDefault(),handleFormSubmission(t,r,a,i,c,o,n,l,s)})}});export{getUniqueValidationData,fieldValidation,onloadCallback};