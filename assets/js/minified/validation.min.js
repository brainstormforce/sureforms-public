async function getUniqueValidationData(e,r,t,s){let o="action=validation_ajax_action&nonce="+encodeURIComponent(s)+"&id="+encodeURIComponent(r);Object.keys(e).forEach(r=>{o+="&"+encodeURIComponent(r)+"="+encodeURIComponent(e[r])});try{var a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o});if(a.ok)return(await a.json()).data}catch(r){console.error(r)}}async function fieldValidation(r,e,t,s){let o=!1,a=null,i=null;var l=document.querySelectorAll('input[aria-unique="true"]');if(0!==l.length){var c={};for(const h of l){var n=h.name,m=h.value;c[n]=m}i=await getUniqueValidationData(c,r,e,t)}for(const S of Array.from(s.querySelectorAll(".srfm-block-single"))){var u=S.closest("form").getAttribute("form-id");if(u===r){var u=S.querySelector("input, textarea,select"),f=u.getAttribute("aria-required"),d=u.getAttribute("aria-unique");let e=u.getAttribute("name");var b,L,p,g,k=u.value,v=S.querySelector(".srfm-error-message");if(e=e&&e.replace(/_/g," "),f&&"hidden"!==u.type&&("true"!==f||k?u&&u.closest(".srfm-block").classList.remove("srfm-error"):(u&&u.closest(".srfm-block").classList.add("srfm-error"),v&&(v.textContent=v.getAttribute("data-error-msg")),o=!0,a=a||u)),"true"===d&&""!==k&&(i?.some(r=>"not unique"===r[e])?(u&&u.closest(".srfm-block").classList.add("srfm-error"),v.textContent=v.getAttribute("data-unique-msg"),o=!0,a=a||u):u&&u.closest(".srfm-block").classList.remove("srfm-error")),S.classList.contains("srfm-multi-choice-block")||S.classList.contains("srfm-checkbox-block")){var q=S.querySelectorAll("input"),d=q[0].getAttribute("aria-required");let e=!1,t=null;for(let r=0;r<q.length;r++)if(t||"hidden"===q[r].type||(t=q[r]),q[r].checked){e=!0;break}"true"!==d||e?v&&S.classList.remove("srfm-error"):(v&&S.classList.add("srfm-error"),o=!0,!a&&t&&(a=t))}if(S.classList.contains("srfm-url-block")&&(d=S.querySelector("input"),S.classList.contains("srfm-url-error"))&&(S.classList.add("srfm-error"),o=!0,a=a||d),S.classList.contains("srfm-phone-block")&&(d=S.querySelectorAll("input")[1],S.classList.contains("srfm-phone-error"))&&(S.classList.add("srfm-error"),o=!0,a=a||d),S.classList.contains("srfm-password-block-wrap")&&(d=S)&&(d=d.querySelector(".srfm-password-confirm-block"))&&(L=d.querySelector(".srfm-input-password-confirm").value,b=d.querySelector(".srfm-error-message"),!L&&b&&"true"===f?(b.textContent=b.getAttribute("data-error-msg"),d.classList.add("srfm-error"),a=a||L,o=!0):L!==k?(d.classList.add("srfm-error"),b.textContent="Confirmation Password is not the same",a=a||L,o=!0):d.classList.remove("srfm-error")),S.classList.contains("srfm-email-block-wrap")&&(b=S)&&(L=b.querySelector(".srfm-email-confirm-block"))&&(d=L.querySelector(".srfm-input-email-confirm"),p=L.querySelector(".srfm-input-email-confirm").value,g=L.querySelector(".srfm-error-message"),!p&&g&&"true"===f?(g.textContent=g.getAttribute("data-error-msg"),L.classList.add("srfm-error"),a=a||d,o=!0):p!==k?(L.classList.add("srfm-error"),g.textContent="Confirmation email is not the same",a=a||d,o=!0):L.classList.remove("srfm-error")),S.classList.contains("srfm-address-block")){var y=S.querySelectorAll('input:not([aria-haspopup="listbox"])'),A=y[1].getAttribute("aria-required");console.log(y);for(let r=1;r<y.length&&"true"===A;r++){if(!y[r].value&&2!==r){S.classList.add("srfm-error"),a=a||y[r],o=!0;break}S.classList.remove("srfm-error")}}S.classList.contains("srfm-upload-block")&&("true"!==(p=(f=S.querySelector(".srfm-input-upload")).getAttribute("aria-required"))||f.value?u&&u.closest(".srfm-block").classList.remove("srfm-error"):("true"===p&&v&&(v.textContent=v.getAttribute("data-error-msg")),u&&u.closest(".srfm-block").classList.add("srfm-error"),o=!0,a=a||f)),S.classList.contains("srfm-number-block")&&(g=u.getAttribute("min"),d=u.getAttribute("max"),k)&&(g&&(""!==g&&Number(k)<Number(g)?(u.closest(".srfm-block").classList.add("srfm-error"),v&&(v.textContent="Minimum value is "+g)):u.closest(".srfm-block").classList.remove("srfm-error")),d)&&(""!==d&&Number(k)>Number(d)?(u.closest(".srfm-block").classList.add("srfm-error"),v&&(v.textContent="Maximum value is "+d)):u.closest(".srfm-block").classList.remove("srfm-error")),S.classList.contains("srfm-rating-block")&&("true"!==(f=S.querySelector(".srfm-input-rating")).getAttribute("aria-required")||f.value?f.closest(".srfm-block").classList.remove("srfm-error"):(f.closest(".srfm-block").classList.add("srfm-error"),o=!0))}}return a&&a.focus(),o}export{fieldValidation};