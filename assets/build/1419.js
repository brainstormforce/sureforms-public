"use strict";(self.webpackChunksureforms=self.webpackChunksureforms||[]).push([[1419],{1419:function(t,r,e){e.r(r),e.d(r,{sc_login_form:function(){return a}});var s=e(6046),i=e(290),o=e(712);e(5115);const a=class{constructor(t){(0,s.r)(this,t),this.step="",this.email="",this.password=""}handleStepChange(){"password"===this.step&&setTimeout((()=>{this.passwordInput.triggerFocus()}),50)}handleEmailChange(){this.email=this.emailInput.value}async submitMagicLink(){try{this.loading=!0,await(0,o.a)({method:"POST",path:"surecart/v1/customer_links",data:{email:this.email,return_url:window.location.href}}),this.step="complete"}catch(t){(null==t?void 0:t.message)?this.error=t.message:this.error=(0,i._)("Something went wrong","surecart"),console.error(this.error)}finally{this.loading=!1}}async login(){try{this.loading=!0;const{redirect_url:t}=await(0,o.a)({method:"POST",path:"surecart/v1/login",data:{login:this.email,password:this.password}});t?window.location.replace(t):window.location.reload()}catch(t){console.error(this.error),this.loading=!1,(null==t?void 0:t.message)?this.error=t.message:this.error=(0,i._)("Something went wrong","surecart")}}renderInner(){return"complete"===this.step?(0,s.h)("sc-alert",{type:"success",open:!0},(0,s.h)("sc-icon",{slot:"icon",name:"check"}),(0,s.h)("span",{slot:"title"},(0,i._)("Sent!","surecart")),(0,s.h)("p",null,(0,i._)("You should receive an email shortly with a link to login.","surecart"))):"password"===this.step&&this.email?(0,s.h)("div",null,(0,s.h)("sc-form",{onScFormSubmit:()=>this.submitMagicLink()},(0,s.h)("sc-button",{type:"primary",submit:!0,full:!0},(0,s.h)("sc-icon",{name:"mail",slot:"prefix"}),(0,i._)("Send a magic link","surecart"))),(0,s.h)("sc-divider",null,(0,i._)("or","surecart")),(0,s.h)("sc-form",{onScFormSubmit:()=>this.login()},(0,s.h)("sc-input",{label:(0,i._)("Enter your password","surecart"),type:"password",ref:t=>this.passwordInput=t,autofocus:!0,required:!0,onScChange:t=>this.password=t.target.value}),(0,s.h)("sc-button",{type:"primary",outline:!0,submit:!0,full:!0},(0,s.h)("sc-icon",{name:"lock",slot:"prefix"}),(0,i._)("Login","surecart")))):(0,s.h)("sc-form",{onScFormSubmit:()=>this.step="password"},(0,s.h)("sc-input",{ref:t=>this.emailInput=t,label:"Email Address",onScChange:()=>this.handleEmailChange(),required:!0,autofocus:!0,type:"email"}),(0,s.h)("sc-button",{type:"primary",submit:!0,full:!0},(0,s.h)("sc-icon",{name:"arrow-right",slot:"suffix"}),(0,i._)("Next","surecart")))}renderError(){if(this.error)return(0,s.h)("sc-alert",{open:!0,type:"danger"},(0,s.h)("span",{slot:"title"},(0,i._)("Error","surecart")),(0,s.h)("span",{innerHTML:this.error}))}render(){return(0,s.h)("div",{class:"login-form"},(0,s.h)("div",{class:"login-form__title",part:"title"},(0,s.h)("slot",{name:"title"})),(0,s.h)("sc-card",null,this.renderInner()),this.loading&&(0,s.h)("sc-block-ui",{spinner:!0}),this.renderError())}static get watchers(){return{step:["handleStepChange"]}}};a.style=".login-form{margin:var(--sc-spacing-xx-large) auto;max-width:400px;position:relative}.login-form__title{text-align:center;margin-bottom:var(--sc-spacing-medium);font-size:var(--sc-font-size-xx-large);font-weight:var(--sc-font-weight-bold)}"}}]);