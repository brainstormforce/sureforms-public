import{fieldValidation}from"./validation";class PageBreakHandler{constructor(t){var e;this.form=t,this.pageBreakContainers=t.querySelectorAll(".srfm-page-break"),this.pageBreakContainers&&!(e=this.pageBreakContainers[0]).querySelector("div.srfm-block")&&(e.remove(),this.pageBreakContainers=t.querySelectorAll(".srfm-page-break")),this.pageBreakLength=this.pageBreakContainers.length,this.submitBtn=t.querySelector(".srfm-submit-container"),this.ajaxUrl=t.getAttribute("ajaxurl"),this.nonce=t.getAttribute("nonce"),this.formId=t.getAttribute("form-id"),this.progress=t.querySelector(".srfm-progress"),this.pageBreakHeader=t.querySelector(".srfm-page-break-header-container"),this.stepsParentDiv=t.querySelector(".srfm-page-break-progress-container"),this.ulEle=t.querySelector("#progressbar"),this.pageBreakHeader&&(this.connectorCount=this.pageBreakHeader.querySelector(".srfm-step-count"),this.connectorTotalCount=this.pageBreakHeader.querySelector(".srfm-step-total"),this.connectorPageTitle=this.pageBreakHeader.querySelector(".srfm-steps-page-title"),this.progressIndicatorType=this.pageBreakHeader.getAttribute("type"),this.isShowLabel=this.pageBreakHeader.getAttribute("toggle-label")),this.connectorParentDiv=t.querySelector(".srfm-steps-container"),this.currentActive=0,this.preBtn=t.querySelector(".srfm-pre-btn"),this.nxtBtn=t.querySelector(".srfm-nxt-btn"),this.originalNxtBtn=this.nxtBtn,"progress-bar"===this.progressIndicatorType&&(this.progressBar=this.pageBreakHeader.querySelector(".srfm-page-break-indicator"),this.progressBarText=this.pageBreakHeader.querySelector(".srfm-progress-bar-text"))}createPageBreakElements(){for(let t=0;t<this.pageBreakLength;t++){var e,r,s,i,a;"steps"===this.progressIndicatorType?((e=document.createElement("div")).classList.add("srfm-text-wrap"),0===t&&e.classList.add("active"),i=document.createElement("div"),a=document.createElement("div"),r=document.createElement("span"),s=document.createElement("span"),r.classList.add("srfm-circle-content"),a.classList.add("srfm-label-wrapper"),s.classList.add("srfm-label-text"),i.classList.add("srfm-circle"),r.textContent=t+1,i.appendChild(r),this.isShowLabel&&(s.textContent=this.pageBreakContainers[t].getAttribute("data"),a.appendChild(s)),e.append(i,a),this.stepsParentDiv.appendChild(e)):"connector"===this.progressIndicatorType?((r=document.createElement("div")).className="srfm-round",0===t&&r.classList.add("active"),(s=document.createElement("input")).classList.add("srfm-round-checkbox"),s.type="checkbox",s.id="srfm-round-checkbox-"+t,s.disabled=!0,(i=document.createElement("label")).htmlFor="srfm-round-checkbox-"+t,r.appendChild(s),r.appendChild(i),this.connectorParentDiv.appendChild(r)):((a=document.createElement("li")).textContent=this.pageBreakContainers[t].getAttribute("data"),0===t&&a.classList.add("active"),this.ulEle.appendChild(a))}"steps"===this.progressIndicatorType?(this.wraps=this.form.querySelectorAll(".srfm-text-wrap"),this.circle=this.form.querySelectorAll(".srfm-circle")):"connector"===this.progressIndicatorType&&(this.wraps=this.form.querySelectorAll(".srfm-round"),this.checkbox=this.form.querySelectorAll(".srfm-round-checkbox"),this.connectorCount)&&(this.connectorCount.textContent="1",this.connectorTotalCount.textContent=this.pageBreakLength,this.isShowLabel)&&(this.connectorPageTitle.textContent=this.pageBreakContainers[0].getAttribute("data"))}initializeFormState(){var t;this.pageBreakContainers[this.currentActive].style.display="flex",this.submitBtn.style.display="none",this.submitBtn.style.width="auto",this.submitBtn.style.margin="0",this.preBtn&&0===this.currentActive&&(this.preBtn.disabled=!0),this.nxtBtn&&this.nxtBtn.addEventListener("click",t=>this.handleNextButtonClick(t)),this.preBtn&&this.preBtn.addEventListener("click",t=>this.handlePreviousButtonClick(t)),"progress-bar"===this.progressIndicatorType&&(t=Math.floor((this.currentActive+1)/this.pageBreakLength*100),this.progressBar.value=t,this.progressBarText.innerText=t+"%")}async handleNextButtonClick(t){t.preventDefault(),await fieldValidation(this.formId,this.ajaxUrl,this.nonce,this.pageBreakContainers[this.currentActive])||(this.currentActive++,this.currentActive===this.pageBreakLength-1&&(this.nxtBtn.style.display="none",this.submitBtn.style.display="block",this.nxtBtn.replaceWith(this.submitBtn)),0!==this.currentActive&&(this.preBtn.disabled=!1),"connector"===this.progressIndicatorType&&this.connectorCount&&(this.connectorCount.textContent=this.currentActive+1,this.isShowLabel)&&(this.connectorPageTitle.textContent=this.pageBreakContainers[this.currentActive].getAttribute("data")),this.updatePageBreakDisplay(),this.update())}handlePreviousButtonClick(t){t.preventDefault(),this.currentActive--,this.currentActive<=0&&(this.preBtn.disabled=!0),this.currentActive<=this.pageBreakLength-1&&(this.nxtBtn.disabled=!1,"block"===this.submitBtn.style.display)&&(this.submitBtn.style.display="none",this.originalNxtBtn.style.display="block",this.submitBtn.replaceWith(this.originalNxtBtn)),"connector"===this.progressIndicatorType&&this.connectorCount&&(t=this.connectorCount.textContent,t=Number(t),this.connectorCount.textContent=t-1,this.isShowLabel)&&(this.connectorPageTitle.textContent=this.pageBreakContainers[this.currentActive].getAttribute("data")),this.updatePageBreakDisplay(),this.update()}updatePageBreakDisplay(){for(let t=0;t<this.pageBreakLength;t++)this.pageBreakContainers[t]&&(this.pageBreakContainers[t].style.display=t===this.currentActive?"flex":"none"),t<this.currentActive?(this.pageBreakContainers[t].classList.add("left"),this.pageBreakContainers[t].classList.remove("right"),this.circle&&this.circle[t].classList.add("filled"),this.checkbox&&(this.checkbox[t].checked=!0)):(this.pageBreakContainers[t].classList.add("right"),this.pageBreakContainers[t].classList.remove("left"),this.circle&&this.circle[t].classList.remove("filled"),this.checkbox&&(this.checkbox[t].checked=!1))}update(){if(this.wraps&&0!==this.wraps.length&&this.wraps.forEach((t,e)=>{e<=this.currentActive?t.classList.add("active"):t.classList.remove("active")}),this.progress){let t=100;var e;t="connector"===this.progressIndicatorType?100:(r=(e=this.progress.parentNode.offsetWidth)-5*parseFloat(getComputedStyle(document.documentElement).fontSize),t=r/e*100),this.progress.style.width=this.currentActive/(this.wraps.length-1)*t+"%"}var r;"progress-bar"===this.progressIndicatorType&&(r=Math.floor((this.currentActive+1)/this.pageBreakLength*100),this.progressBar.value=r,this.progressBarText.innerText=r+"%")}}document.addEventListener("DOMContentLoaded",function(){Array.from(document.querySelectorAll(".srfm-form")).forEach(t=>{t=new PageBreakHandler(t);t.createPageBreakElements(),t.initializeFormState()})});