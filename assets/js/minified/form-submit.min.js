import{fieldValidation}from"./validation";function submitFormData(e){var t,s,r=srfm_submit.site_url,e=new FormData(e),a=new FormData;for([t,s]of e.entries())t.includes("srfm-email-confirm")||t.includes("srfm-password-confirm")||a.append(t,s);return fetch(r+"/wp-json/sureforms/v1/submit-form",{method:"POST",headers:{"X-WP-Nonce":srfm_submit.nonce},body:a}).then(e=>{if(e.ok)return e}).catch(e=>{console.log(e)})}function showSuccessMessage(e,t,s){"hide form"===s?(t.style.opacity=1,t.style.display="none",e.classList.add("srfm-active"),setTimeout(()=>{e.style.opacity=1},500)):(e.classList.add("srfm-active"),t.reset())}function redirectToUrl(e){window.location.assign(e)}function showErrorMessage(e){e.removeAttribute("hidden"),console.error("Network Error")}async function handleFormSubmission(e,t,s,r,a,o,i,n,c,m){try{a.classList.add("srfm-active"),await fieldValidation(t,s,r,e)?a.classList.remove("srfm-active"):(await submitFormData(e)?"same page"===c?showSuccessMessage(i,e,m):redirectToUrl(o):showErrorMessage(n),a.classList.remove("srfm-active"))}catch(e){a.classList.remove("srfm-active"),showErrorMessage(n)}}function extractFormAttributesAndElements(e){var t=e.getAttribute("form-id"),s=e.getAttribute("message-type"),r=e.getAttribute("success-url"),a=e.getAttribute("ajaxurl"),o=e.getAttribute("nonce"),i=e.querySelector(".srfm-loader"),n=e.nextElementSibling,c=e.querySelector(".srfm-error-message"),m=e.querySelector("#srfm-submit-btn"),u=m.getAttribute("data-sitekey"),l=m.getAttribute("recaptcha-type");return{formId:t,submitType:s,successUrl:r,ajaxUrl:a,nonce:o,loader:i,successMessage:n,errorMessage:c,submitBtn:m,siteKey:u,recaptchaType:l,afterSubmission:e.getAttribute("after-submission")}}function onloadCallback(){Array.from(document.querySelectorAll(".srfm-form")).forEach(e=>{const{formId:t,submitType:s,successUrl:r,ajaxUrl:a,nonce:o,loader:i,successMessage:n,errorMessage:c,submitBtn:m,siteKey:u,recaptchaType:l,afterSubmission:d}=extractFormAttributesAndElements(e);let f=!1;"v2-invisible"===l&&(grecaptcha.render(m,{sitekey:u,callback:()=>{handleFormSubmission(e,t,a,o,i,r,n,c,s,d),f=!0}}),m.addEventListener("click",()=>{f&&handleFormSubmission(e,t,a,o,i,r,n,c,s,d)}))})}document.addEventListener("DOMContentLoaded",function(){for(const t of Array.from(document.querySelectorAll(".srfm-form"))){const{formId:s,submitType:r,successUrl:a,ajaxUrl:o,nonce:i,loader:n,successMessage:c,errorMessage:m,submitBtn:e,siteKey:u,recaptchaType:l,afterSubmission:d}=extractFormAttributesAndElements(t);"v3-reCAPTCHA"===l?e.addEventListener("click",e=>{e.preventDefault(),grecaptcha.ready(function(){grecaptcha.execute(u,{action:"submit"}).then(async function(e){e&&handleFormSubmission(t,s,o,i,n,a,c,m,r,d)})})}):t.addEventListener("submit",async function(e){e.preventDefault(),handleFormSubmission(t,s,o,i,n,a,c,m,r,d)})}}),window.onloadCallback=onloadCallback;