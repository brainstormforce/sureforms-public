async function getUniqueValidationData(r,e,t,s){let o="action=validation_ajax_action&nonce="+encodeURIComponent(s)+"&id="+encodeURIComponent(e);Object.keys(r).forEach(e=>{o+="&"+encodeURIComponent(e)+"="+encodeURIComponent(r[e])});try{var a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o});if(a.ok)return(await a.json()).data}catch(e){console.error(e)}}async function fieldValidation(e,r,t,s){let o=!1,a=null,i=null;var c=document.querySelectorAll('input[aria-unique="true"]');if(0!==c.length){var n={};for(const q of c){var l=q.name,m=q.value;n[l]=m}i=await getUniqueValidationData(n,e,r,t)}for(const S of Array.from(s.querySelectorAll(".srfm-block-single"))){var u=S.closest("form").getAttribute("form-id");if(u===e){var u=S.querySelector("input, textarea,select"),f=u.getAttribute("aria-required"),d=u.getAttribute("aria-unique");let r=u.getAttribute("name");var b,g,y,p,v=u.value,L=S.querySelector(".srfm-error-message");if(r=r&&r.replace(/_/g," "),f&&"hidden"!==u.type&&("true"!==f||v?u&&u.closest(".srfm-block").classList.remove("srfm-error"):(u&&u.closest(".srfm-block").classList.add("srfm-error"),L&&(L.textContent=L.getAttribute("data-error-msg")),o=!0,a=a||u)),"true"===d&&""!==v&&(i?.some(e=>"not unique"===e[r])?(u&&u.closest(".srfm-block").classList.add("srfm-error"),L.textContent=L.getAttribute("data-unique-msg"),o=!0,a=a||u):u&&u.closest(".srfm-block").classList.remove("srfm-error")),S.classList.contains("srfm-multi-choice-block")||S.classList.contains("srfm-checkbox-block")){var h=S.querySelectorAll("input"),d=h[0].getAttribute("aria-required");let r=!1,t=null;for(let e=0;e<h.length;e++)if(t||"hidden"===h[e].type||(t=h[e]),h[e].checked){r=!0;break}"true"!==d||r?L&&S.classList.remove("srfm-error"):(L&&S.classList.add("srfm-error"),o=!0,!a&&t&&(a=t))}if(S.classList.contains("srfm-url-block")&&(d=S.querySelector("input"),S.classList.contains("srfm-url-error"))&&(S.classList.add("srfm-error"),o=!0,a=a||d),S.classList.contains("srfm-phone-block")&&(d=S.querySelectorAll("input")[1],S.classList.contains("srfm-phone-error"))&&(S.classList.add("srfm-error"),o=!0,a=a||d),S.classList.contains("srfm-password-block-wrap")&&(d=S)&&(d=d.querySelector(".srfm-password-confirm-block"))&&(g=d.querySelector(".srfm-input-password-confirm").value,b=d.querySelector(".srfm-error-message"),!g&&b&&"true"===f?(b.textContent=b.getAttribute("data-error-msg"),d.classList.add("srfm-error"),a=a||g,o=!0):g!==v?(d.classList.add("srfm-error"),b.textContent="Confirmation Password is not the same",a=a||g,o=!0):d.classList.remove("srfm-error")),S.classList.contains("srfm-email-block-wrap")&&(b=S)&&(g=b.querySelector(".srfm-email-confirm-block"))&&(d=g.querySelector(".srfm-input-email-confirm"),y=g.querySelector(".srfm-input-email-confirm").value,p=g.querySelector(".srfm-error-message"),!y&&p&&"true"===f?(p.textContent=p.getAttribute("data-error-msg"),g.classList.add("srfm-error"),a=a||d,o=!0):y!==v?(g.classList.add("srfm-error"),p.textContent="Confirmation email is not the same",a=a||d,o=!0):g.classList.remove("srfm-error")),S.classList.contains("srfm-address-block")){var A=S.querySelectorAll("input,select"),k=A[1].getAttribute("aria-required");for(let e=1;e<A.length&&"true"===k;e++)A[e].value||2===e?S.classList.remove("srfm-error"):(S.classList.add("srfm-error"),o=!0,a=a||A[e])}S.classList.contains("srfm-upload-block")&&("true"!==(y=(f=S.querySelector(".srfm-input-upload")).getAttribute("aria-required"))||f.value?u&&u.closest(".srfm-block").classList.remove("srfm-error"):("true"===y&&L&&(L.textContent=L.getAttribute("data-error-msg")),u&&u.closest(".srfm-block").classList.add("srfm-error"),o=!0,a=a||f)),S.classList.contains("srfm-number-block")&&(p=u.getAttribute("min"),d=u.getAttribute("max"),v)&&(p&&(""!==p&&Number(v)<Number(p)?(u.closest(".srfm-block").classList.add("srfm-error"),L&&(L.textContent="Minimum value is "+p)):u.closest(".srfm-block").classList.remove("srfm-error")),d)&&(""!==d&&Number(v)>Number(d)?(u.closest(".srfm-block").classList.add("srfm-error"),L&&(L.textContent="Maximum value is "+d)):u.closest(".srfm-block").classList.remove("srfm-error")),S.classList.contains("srfm-rating-block")&&("true"!==(f=S.querySelector(".srfm-input-rating")).getAttribute("aria-required")||f.value?f.closest(".srfm-block").classList.remove("srfm-error"):(f.closest(".srfm-block").classList.add("srfm-error"),o=!0))}}return a&&a.focus(),o}function submitFormData(e){var r=sureforms_submit.site_url,e=new FormData(e);return fetch(r+"/wp-json/sureforms/v1/submit-form",{method:"POST",body:e}).then(e=>{if(e.ok)return e}).catch(e=>{console.log(e)})}function showSuccessMessage(e,r){r.style.opacity=1,r.style.display="none",e.classList.add("srfm-active"),setTimeout(()=>{e.style.opacity=1},500)}function redirectToUrl(e){window.location.assign(e)}function showErrorMessage(e){e.removeAttribute("hidden"),console.error("Network Error")}async function handleFormSubmission(e,r,t,s,o,a,i,c,n){try{var l;o.classList.add("srfm-active"),await fieldValidation(r,t,s,e)?o.classList.remove("srfm-active"):(l=await submitFormData(e),o.classList.add("srfm-active"),l?"message"===n?showSuccessMessage(i,e):redirectToUrl(a):showErrorMessage(c))}catch(e){o.classList.remove("srfm-active"),showErrorMessage(c)}}function extractFormAttributesAndElements(e){var r=e.getAttribute("form-id"),t=e.getAttribute("message-type"),s=e.getAttribute("success-url"),o=e.getAttribute("ajaxurl"),a=e.getAttribute("nonce"),i=e.querySelector(".srfm-loader"),c=e.nextElementSibling,n=e.querySelector(".srfm-error-message"),e=e.querySelector("#srfm-submit-btn"),l=e.getAttribute("data-sitekey"),m=e.getAttribute("recaptcha-type");return{formId:r,submitType:t,successUrl:s,ajaxUrl:o,nonce:a,loader:i,successMessage:c,errorMessage:n,submitBtn:e,siteKey:l,recaptchaType:m}}function onloadCallback(){Array.from(document.querySelectorAll(".srfm-form")).forEach(e=>{const{formId:r,submitType:t,successUrl:s,ajaxUrl:o,nonce:a,loader:i,successMessage:c,errorMessage:n,submitBtn:l,siteKey:m,recaptchaType:u}=extractFormAttributesAndElements(e);let f=!1;"v2-invisible"===u&&(grecaptcha.render(l,{sitekey:m,callback:()=>{handleFormSubmission(e,r,o,a,i,s,c,n,t),f=!0}}),l.addEventListener("click",()=>{f&&handleFormSubmission(e,r,o,a,i,s,c,n,t)}))})}document.addEventListener("DOMContentLoaded",function(){for(const r of Array.from(document.querySelectorAll(".srfm-form"))){const{formId:t,submitType:s,successUrl:o,ajaxUrl:a,nonce:i,loader:c,successMessage:n,errorMessage:l,submitBtn:e,siteKey:m,recaptchaType:u}=extractFormAttributesAndElements(r);"v3-reCAPTCHA"===u?e.addEventListener("click",e=>{e.preventDefault(),grecaptcha.ready(function(){grecaptcha.execute(m,{action:"submit"}).then(async function(e){e&&handleFormSubmission(r,t,a,i,c,o,n,l,s)})})}):r.addEventListener("submit",async function(e){e.preventDefault(),handleFormSubmission(r,t,a,i,c,o,n,l,s)})}});export{getUniqueValidationData,fieldValidation,onloadCallback};