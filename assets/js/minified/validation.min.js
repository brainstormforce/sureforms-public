async function getUniqueValidationData(e,r,t,s){let o="action=validation_ajax_action&nonce="+encodeURIComponent(s)+"&id="+encodeURIComponent(r);Object.keys(e).forEach(r=>{o+="&"+encodeURIComponent(r)+"="+encodeURIComponent(e[r])});try{var a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o});if(a.ok)return(await a.json()).data}catch(r){console.error(r)}}async function fieldValidation(r,e,t,s){let o=!1,a=null,i=null;var l=document.querySelectorAll('input[data-unique="true"]');if(0!==l.length){var c={};for(const S of l){var n=S.name,m=S.value;c[n]=m}i=await getUniqueValidationData(c,r,e,t)}for(const h of Array.from(s.querySelectorAll(".srfm-block-single"))){var u=h.closest("form").getAttribute("form-id");if(u===r){var u=h.querySelector("input, textarea,select"),f=u.getAttribute("aria-required"),d=u.getAttribute("data-unique");let e=u.getAttribute("name");var b,L,p,g,k=u.value,q=h.querySelector(".srfm-error-message");if(e=e&&e.replace(/_/g," "),f&&"hidden"!==u.type&&("true"!==f||k?u&&u.closest(".srfm-block").classList.remove("srfm-error"):(u&&u.closest(".srfm-block").classList.add("srfm-error"),q&&(q.textContent=q.getAttribute("data-error-msg")),o=!0,a=a||u)),"true"===d&&""!==k&&(i?.some(r=>"not unique"===r[e])?(u&&u.closest(".srfm-block").classList.add("srfm-error"),q.textContent=q.getAttribute("data-unique-msg"),o=!0,a=a||u):u&&u.closest(".srfm-block").classList.remove("srfm-error")),h.classList.contains("srfm-multi-choice-block")||h.classList.contains("srfm-checkbox-block")){var v=h.querySelectorAll("input"),d=v[0].getAttribute("aria-required");let e=!1,t=null;for(let r=0;r<v.length;r++)if(t||"hidden"===v[r].type||(t=v[r]),v[r].checked){e=!0;break}"true"!==d||e?q&&h.classList.remove("srfm-error"):(q&&h.classList.add("srfm-error"),o=!0,!a&&t&&(a=t))}if(h.classList.contains("srfm-url-block")&&(d=h.querySelector("input"),h.classList.contains("srfm-url-error"))&&(h.classList.add("srfm-error"),o=!0,a=a||d),h.classList.contains("srfm-phone-block")&&(d=h.querySelectorAll("input")[1],h.classList.contains("srfm-phone-error"))&&(h.classList.add("srfm-error"),o=!0,a=a||d),h.classList.contains("srfm-password-block-wrap")&&(d=h)&&(d=d.querySelector(".srfm-password-confirm-block"))&&(L=d.querySelector(".srfm-input-password-confirm").value,b=d.querySelector(".srfm-error-message"),!L&&b&&"true"===f?(b.textContent=b.getAttribute("data-error-msg"),d.classList.add("srfm-error"),a=a||L,o=!0):L!==k?(d.classList.add("srfm-error"),b.textContent="Confirmation Password is not the same",a=a||L,o=!0):d.classList.remove("srfm-error")),h.classList.contains("srfm-email-block-wrap")&&(b=h)&&(L=b.querySelector(".srfm-email-confirm-block"))&&(d=L.querySelector(".srfm-input-email-confirm"),p=L.querySelector(".srfm-input-email-confirm").value,g=L.querySelector(".srfm-error-message"),!p&&g&&"true"===f?(g.textContent=g.getAttribute("data-error-msg"),L.classList.add("srfm-error"),a=a||d,o=!0):p!==k?(L.classList.add("srfm-error"),g.textContent="Confirmation email is not the same",a=a||d,o=!0):L.classList.remove("srfm-error")),h.classList.contains("srfm-address-block")){var y=h.querySelectorAll("input"),A=y[1].getAttribute("aria-required"),f=h.querySelector(".ts-wrapper");let e="";f&&(e=f.classList.contains("has-items"));for(let r=1;r<y.length&&"true"===A;r++){if(!y[r].value&&2!==r&&5!==r||5===r&&!e){h.classList.add("srfm-error"),a=a||y[r],o=!0;break}h.classList.remove("srfm-error")}}h.classList.contains("srfm-upload-block")&&("true"!==(g=(p=h.querySelector(".srfm-input-upload")).getAttribute("aria-required"))||p.value?u&&u.closest(".srfm-block").classList.remove("srfm-error"):("true"===g&&q&&(q.textContent=q.getAttribute("data-error-msg")),u&&u.closest(".srfm-block").classList.add("srfm-error"),o=!0,a=a||p)),h.classList.contains("srfm-number-block")&&(d=u.getAttribute("min"),f=u.getAttribute("max"),k)&&(d&&(""!==d&&Number(k)<Number(d)?(u.closest(".srfm-block").classList.add("srfm-error"),q&&(q.textContent="Minimum value is "+d)):u.closest(".srfm-block").classList.remove("srfm-error")),f)&&(""!==f&&Number(k)>Number(f)?(u.closest(".srfm-block").classList.add("srfm-error"),q&&(q.textContent="Maximum value is "+f)):u.closest(".srfm-block").classList.remove("srfm-error")),h.classList.contains("srfm-rating-block")&&("true"!==(d=h.querySelector(".srfm-input-rating")).getAttribute("aria-required")||d.value?d.closest(".srfm-block").classList.remove("srfm-error"):(d.closest(".srfm-block").classList.add("srfm-error"),o=!0))}}return a&&a.focus(),o}export{fieldValidation};